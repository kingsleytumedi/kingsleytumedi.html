// Initialize cart from localStorage
let cart = JSON.parse(localStorage.getItem('cart')) || [];

// DOM Elements
const cartItemsEl = document.getElementById('cart-items');
const cartTotalEl = document.getElementById('cart-total');
const checkoutBtn = document.getElementById('checkout-btn');

// Render cart items
function renderCartItems() {
  if (cart.length === 0) {
    cartItemsEl.innerHTML = '<p class="empty-cart">Your cart is empty</p>';
    cartTotalEl.textContent = 'P0.00';
    return;
  }

  cartItemsEl.innerHTML = cart.map(item => `
    <div class="cart-item">
      <img src="${item.image}" alt="${item.name}">
      <div class="cart-item-details">
        <h3 class="cart-item-title">${item.name}</h3>
        <p class="cart-item-price">${item.price} Ã— ${item.quantity}</p>
      </div>
      <button class="remove-item" data-id="${item.id}">
        <i class="fas fa-trash"></i>
      </button>
    </div>
  `).join('');

  // Calculate total
  const total = cart.reduce((sum, item) => {
    const price = parseFloat(item.price.replace(/[^\d.]/g, ''));
    return sum + (price * item.quantity);
  }, 0);

  cartTotalEl.textContent = `P${total.toFixed(2)}`;

  // Add event listeners to remove buttons
  document.querySelectorAll('.remove-item').forEach(btn => {
    btn.addEventListener('click', () => {
      const itemId = btn.getAttribute('data-id');
      removeFromCart(itemId);
    });
  });
}

// Remove item from cart
function removeFromCart(id) {
  cart = cart.filter(item => item.id !== id);
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCartItems();
  updateCartCount(); // From main.js
}

// Checkout button
checkoutBtn.addEventListener('click', () => {
  alert(`Order confirmed! Total: ${cartTotalEl.textContent}`);
  cart = [];
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCartItems();
  updateCartCount();
});

// Initial render
renderCartItems();
